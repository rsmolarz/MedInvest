{% extends "base.html" %}

{% block title %}{{ deal.title }} - Investment Deal{% endblock %}

{% block content %}
<div class="container py-4">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('deals') }}">Deals</a></li>
            <li class="breadcrumb-item active">{{ deal.title[:40] }}...</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-{{ 'success' if deal.deal_type == 'real_estate' else 'primary' if deal.deal_type == 'fund' else 'info' }}">
                            {{ deal.deal_type.replace('_', ' ').title() }}
                        </span>
                        <div>
                            {% if deal.accredited_only %}<span class="badge bg-warning text-dark me-1">Accredited Only</span>{% endif %}
                            {% if deal.physician_only %}<span class="badge bg-dark">Physicians Only</span>{% endif %}
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <h2 class="mb-3">{{ deal.title }}</h2>
                    <p class="lead text-muted">{{ deal.description }}</p>

                    <hr>

                    <div class="row text-center mb-4">
                        <div class="col-md-3 col-6 mb-3">
                            <div class="border rounded p-3">
                                <small class="text-muted d-block">Minimum Investment</small>
                                <strong class="h4 text-primary">${{ "{:,.0f}".format(deal.minimum_investment) }}</strong>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="border rounded p-3">
                                <small class="text-muted d-block">Projected Return</small>
                                <strong class="h4 text-success">{{ deal.projected_return or 'Varies' }}</strong>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="border rounded p-3">
                                <small class="text-muted d-block">Investment Term</small>
                                <strong class="h5">{{ deal.investment_term or 'TBD' }}</strong>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="border rounded p-3">
                                <small class="text-muted d-block">Interest</small>
                                <strong class="h5">{{ deal.interest_count }} investors</strong>
                            </div>
                        </div>
                    </div>

                    {% if deal.target_raise %}
                    <div class="mb-4">
                        <div class="d-flex justify-content-between small mb-1">
                            <span>Raised: ${{ "{:,.0f}".format(deal.current_raised or 0) }}</span>
                            <span>Target: ${{ "{:,.0f}".format(deal.target_raise) }}</span>
                        </div>
                        <div class="progress" style="height: 25px;">
                            {% set pct = ((deal.current_raised or 0) / deal.target_raise * 100) if deal.target_raise else 0 %}
                            <div class="progress-bar bg-success" style="width: {{ pct }}%">{{ "{:.0f}".format(pct) }}%</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if deal.location %}
                    <p><i class="fas fa-map-marker-alt text-danger me-2"></i><strong>Location:</strong> {{ deal.location }}</p>
                    {% endif %}
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-building me-2"></i>Sponsor Information</h5>
                </div>
                <div class="card-body">
                    <h5>{{ deal.sponsor_name }}</h5>
                    {% if deal.sponsor_bio %}
                    <p>{{ deal.sponsor_bio }}</p>
                    {% endif %}
                    {% if deal.sponsor_track_record %}
                    <h6>Track Record</h6>
                    <p class="text-muted">{{ deal.sponsor_track_record }}</p>
                    {% endif %}
                </div>
            </div>

            {% if deal.offering_document_url or deal.pitch_deck_url %}
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Documents</h5>
                </div>
                <div class="card-body">
                    {% if deal.pitch_deck_url %}
                    <a href="{{ deal.pitch_deck_url }}" target="_blank" class="btn btn-outline-primary me-2">
                        <i class="fas fa-file-powerpoint me-1"></i>Pitch Deck
                    </a>
                    {% endif %}
                    {% if deal.offering_document_url %}
                    <a href="{{ deal.offering_document_url }}" target="_blank" class="btn btn-outline-secondary">
                        <i class="fas fa-file-pdf me-1"></i>Offering Document
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="mb-3">Express Interest</h5>
                    {% if user_interest %}
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-1"></i>
                        You've expressed interest. The sponsor will contact you soon.
                    </div>
                    {% else %}
                    <form action="{{ url_for('deal_express_interest', deal_id=deal.id) }}" method="POST">
                        <div class="mb-3">
                            <label class="form-label">Investment Amount ($)</label>
                            <input type="number" name="investment_amount" class="form-control" min="{{ deal.minimum_investment }}" step="1000" placeholder="{{ deal.minimum_investment }}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Message (optional)</label>
                            <textarea name="message" class="form-control" rows="3" placeholder="Questions or comments..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i class="fas fa-hand-paper me-1"></i>I'm Interested
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>

            {% if deal.deadline %}
            <div class="card shadow-sm border-warning mb-4">
                <div class="card-body text-center">
                    <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                    <h6>Investment Deadline</h6>
                    <strong>{{ deal.deadline.strftime('%B %d, %Y') }}</strong>
                </div>
            </div>
            {% endif %}

            <div class="card shadow-sm">
                <div class="card-body">
                    <h6><i class="fas fa-info-circle me-2"></i>Quick Facts</h6>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2"><i class="fas fa-eye text-muted me-2"></i>{{ deal.view_count }} views</li>
                        <li class="mb-2"><i class="fas fa-calendar text-muted me-2"></i>Posted {{ deal.created_at.strftime('%b %d, %Y') }}</li>
                        {% if deal.sponsor_contact %}
                        <li><i class="fas fa-envelope text-muted me-2"></i>{{ deal.sponsor_contact }}</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="alert alert-warning mt-4">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <strong>Important:</strong> This is not investment advice. Investing involves risk, including loss of principal. 
        Consult with qualified financial and legal advisors before making investment decisions.
    </div>
</div>
{% endblock %}
